#!/bin/sh

echo "$(basename $0): "

# necessary to get profile support (__git_ps1 is stored in there)
# source $HOME/.profile
# source $HOME/.functions

# Check to see if LOGS_DIR is set
if [[ ! -n $LOGS_DIR ]] ; then
  ! echo -e "${ERROR_RED}*** Please set \$LOGS_DIR --> shared logs directory${NC}"
  exit
else
  logFile=$LOGS_DIR/gir-git_record
fi

pushd . > /dev/null
i=0
while read line ; do
  echo "-----------"

  url=$(echo $line | awk '{print $1}')
  direc=$(echo $line | awk '{print $2}')

  header=${direc##*/}
  direc=${direc%/*}

  mkdir -p $direc
  cd $direc
  echo -n "${header}: "
  if [[ -d $header ]] ; then
    echo "pulling ... "
    cd $header
    # echo $(__git_ps1_colorize "%s")
    { 
      git pull && echo -e "${GREEN}pulled${NC}" 
    } || {
      echo -e "${ERROR_RED}*** not pulled ($header)$NC"
    }
  else
    echo "cloning ..."
    { 
      git clone $url $header && echo -e "${BLUE_BRIGHT}cloned${NC}"  
    } || {
      echo -e "${ERROR_RED}*** not cloned ($header)$NC"
    }
  fi

  echo "-----------"
  let i++
done < $logFile
popd > /dev/null
